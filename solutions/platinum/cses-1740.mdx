---
id: cses-1740
source: CSES
title: Intersection Points
author: Mihnea Brebenel
---

## Explanation

Transform both endpoints of each line into events and sort them after the ordinate - the $y$ coordinate. 
While sweeping through the events, maintain the active points into a [BIT](https://usaco.guide/gold/PURS#binary-indexed-tree).

## Implementation

**Time Complexity:** $\mathcal{O}(N \cdot \log{N})$

<LanguageSection>
<CPPSection>

```cpp 
#include <algorithm>
#include <iostream>
#include <vector>

using namespace std;

struct Event { int type, y, a, b; };

// BeginCodeSnip{Binary Indexed Tree}

template <class T> class BIT {
  private:
	int size;
	vector<T> bit;
	vector<T> arr;

  public:
	BIT(int size) : size(size), bit(size + 1), arr(size) {}

	/** Sets the value at index ind to val. */
	void set(int ind, T val) { add(ind, val - arr[ind]); }

	/** Adds val to the element at index ind. */
	void add(int ind, T val) {
		arr[ind] += val;
		ind++;
		for (; ind <= size; ind += ind & -ind) { bit[ind] += val; }
	}

	/** @return The sum of all values in [0, ind]. */
	T pref_sum(int ind) {
		ind++;
		T total = 0;
		for (; ind > 0; ind -= ind & -ind) { total += bit[ind]; }
		return total;
	}
};

// EndCodeSnip

int main() { 
	const int MAX_X = 1e6;
	int n;
	cin >> n;
	vector<Event> events;
	for(int i = 0; i < n; i++) {
		int a, b, x, y;
		cin >> a >> b >> x >> y;
		// Avoid negative coordinates by adding MAX_X
		if(a == x) {
			// Vertical line
			events.push_back({2, b, a + MAX_X, -1});
			events.push_back({3, y, a + MAX_X, -1});
		} else {
			// Horizontal line
			events.push_back({1, b, a + MAX_X, x + MAX_X});

		}
	}

    // Sort after the ordinate
	sort(events.begin(), events.end(), [](const Event &a, const Event &b) {
		return a.y < b.y;
	});

	long long ans = 0;
	BIT<long long> bit(2 * MAX_X);
	for(const Event &e : events) {
		if(e.type == 1) {
            // Check how many vertical lines intersect the current horizontal line
			ans += bit.pref_sum(e.b) - bit.pref_sum(e.a - 1);
		} else if(e.type == 2) {
			bit.add(e.a, 1);
		} else {
			bit.add(e.a, -1);
		}
	}
	cout << ans << '\n';
}

```

</CPPSection>
</LanguageSection>